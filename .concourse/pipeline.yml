---
resources:

- name: keycloak-cas
  type: git
  icon: github
  public: true
  source:
    branch: main
    password: (("github.com"/token.token))
    uri: https://github.com/RoboJackets/keycloak-cas
    username: x-access-token
  tags:
  - resources
  webhook_token: ((webhook-token))

jobs:

- name: build
  public: true
  serial: true
  plan:
  - get: keycloak-cas
    trigger: true

  - task: build-jar
    config:
      platform: linux
      image_resource:
        type: registry-image
        source:
          repository: maven
          tag: 3-amazoncorretto-11
      inputs:
      - name: keycloak-cas
      params:
        AWS_ACCESS_KEY_ID: ((aws/sts/sandbox.access_key))
        AWS_SECRET_ACCESS_KEY: ((aws/sts/sandbox.secret_key))
        AWS_SESSION_TOKEN: ((aws/sts/sandbox.security_token))
      run:
        path: mvn
        dir: keycloak-cas
        args:
        - clean
        - com.spotify.fmt:fmt-maven-plugin:check
        - package
        - deploy
        - --settings
        - .concourse/settings.xml
